# 開発計画・タスク分割 (2025-12-10)

## 開発方針
- **開発プロセス**: SDD(仕様駆動開発) + TDD(テスト駆動開発)
- **技術スタック**: Electron + Vite + React(TypeScript)
- **モジュール分割**: core(ビジネスロジック) / ui(プレゼンテーション層) / infra(インフラ層)
- **テスト**: 単体テスト(Vitest) + E2E(Playwright)

## 開発順序の考え方
1. **ボトムアップアプローチ**: データモデル → ビジネスロジック → UI の順で実装
2. **段階的デリバリー**: 各フェーズで独立した機能を完成させ、動作確認可能な状態を維持
3. **依存関係の最小化**: 疎結合を保ち、並行開発を可能にする
4. **リスクの早期解決**: 技術的に不確実性の高い部分(DSL、レイアウトエンジン)を優先

---

## Phase 1: プロジェクト基盤とデータモデル実装

### 目的
- 開発環境構築
- データモデル(core層)の実装
- 永続化層(IndexedDB)の実装

### タスク一覧

#### Task 1.1: プロジェクト初期化とビルド環境構築
**仕様確認**:
- Electron + Vite + React + TypeScript 環境
- ディレクトリ構成: `src/core`, `src/ui`, `src/infra`, `test/`
- ビルド設定: Vite config, TypeScript config, ESLint config

**試験設計**:
- TC-1.1.1: `npm run dev` でアプリが起動すること
- TC-1.1.2: `npm run build` でビルドが成功すること
- TC-1.1.3: `npm test` でテストランナーが起動すること

**実装内容**:
- `package.json` 作成(依存関係定義)
- `vite.config.ts` 作成(Electron メイン/レンダラー設定)
- `tsconfig.json` 作成(TypeScript 設定)
- `.eslintrc.json` 作成(コーディング規約)
- ディレクトリ構成作成

**試験実行**: 実装後に TC-1.1.1〜1.1.3 を実行し、結果を記録

---

#### Task 1.2: データモデル実装(core/models)
**仕様確認**:
- テーブル設計([doc/24_table_design_document.md](../doc/24_table_design_document.md))に基づく
- 主要エンティティ: Project, StateList, State, EventList, Event, TransitionTable, TransitionCell

**試験設計**:
- TC-1.2.1: Project モデルのインスタンス生成が正しく動作すること
- TC-1.2.2: State モデルで階層深さ(depth)が正しく計算されること(最大5)
- TC-1.2.3: State の親子関係で無限ループを検出できること
- TC-1.2.4: TransitionCell のバリデーション(nextStateId が存在する状態を参照)が動作すること

**実装内容**:
```typescript
// src/core/models/Project.ts
// src/core/models/StateList.ts
// src/core/models/State.ts
// src/core/models/EventList.ts
// src/core/models/Event.ts
// src/core/models/TransitionTable.ts
// src/core/models/TransitionCell.ts
```
- 各モデルクラス実装
- バリデーションロジック実装
- ユーティリティ関数(ID生成、タイムスタンプ等)

**試験実行**: `test/core/models/*.test.ts` を作成・実行

---

#### Task 1.3: データ永続化層実装(infra/database)
**仕様確認**:
- IndexedDB(Dexie)を使用
- テーブル設計([doc/24_table_design_document.md](../doc/24_table_design_document.md) Section 3)に基づく
- CRUD 操作の実装

**試験設計**:
- TC-1.3.1: データベース初期化が正しく動作すること
- TC-1.3.2: Project の保存・読み込みが正しく動作すること
- TC-1.3.3: State の階層構造を含む保存・読み込みが正しく動作すること
- TC-1.3.4: TransitionCell の保存・読み込みが正しく動作すること
- TC-1.3.5: 外部キー制約違反時にエラーがスローされること

**実装内容**:
```typescript
// src/infra/database/DexieDatabase.ts
// src/infra/database/repositories/ProjectRepository.ts
// src/infra/database/repositories/StateRepository.ts
// src/infra/database/repositories/EventRepository.ts
// src/infra/database/repositories/TransitionRepository.ts
```
- Dexie スキーマ定義
- リポジトリパターンによる CRUD 実装
- トランザクション管理

**試験実行**: `test/infra/database/*.test.ts` を作成・実行

---

#### Task 1.4: 状態管理層実装(core/state)
**仕様確認**:
- Zustand + Immer による状態管理
- Undo/Redo 機能(100ステップ保持)
- 自動保存機能(デフォルト30秒間隔)

**試験設計**:
- TC-1.4.1: ストアの初期化が正しく動作すること
- TC-1.4.2: Undo/Redo が正しく動作すること(100ステップ保持)
- TC-1.4.3: 自動保存が設定間隔で実行されること
- TC-1.4.4: メモリ使用量が500MBを超えた場合に古いステップが破棄されること

**実装内容**:
```typescript
// src/core/state/ProjectStore.ts
// src/core/state/UndoRedoManager.ts
// src/core/state/AutoSaveManager.ts
```
- Zustand ストア実装
- Undo/Redo スタック管理
- 自動保存タイマー実装

**試験実行**: `test/core/state/*.test.ts` を作成・実行

---

## Phase 2: 状態遷移表(グリッド)実装

### 目的
- AG Grid Community を使用した状態遷移表の実装
- セル編集、検索、ズーム、行折畳機能の実装

### タスク一覧

#### Task 2.1: 基本グリッド実装
**仕様確認**:
- AG Grid Community 使用
- 固定ヘッダ、仮想スクロール
- 行=イベント、列=状態の2次元表示

**試験設計**:
- TC-2.1.1: グリッドが正しく表示されること
- TC-2.1.2: 10,000セル(100x100)のデータを100ms以内で表示できること
- TC-2.1.3: スクロールが滑らかに動作すること(60fps維持)

**実装内容**:
```typescript
// src/ui/components/TransitionTable/TransitionTable.tsx
// src/ui/components/TransitionTable/GridConfig.ts
```
- AG Grid の初期設定
- カスタムカラム定義
- データバインディング

**試験実行**: E2E テスト + 性能測定

---

#### Task 2.2: セル表示モード切替
**仕様確認**:
- 「処理のみ」「遷移先のみ」「両方」の3モード
- ツールバーにトグルボタン配置

**試験設計**:
- TC-2.2.1: 表示モード切替ボタンが正しく動作すること
- TC-2.2.2: 切替後のセル内容が正しく表示されること
- TC-2.2.3: 表示モードがパネル単位で保持されること

**実装内容**:
```typescript
// src/ui/components/TransitionTable/CellDisplayMode.tsx
// src/ui/components/TransitionTable/CellRenderer.tsx
```
- カスタムセルレンダラー実装
- 表示モード切替ロジック

**試験実行**: E2E テスト

---

#### Task 2.3: セル編集ダイアログ(基本版)
**仕様確認**:
- セルダブルクリックでモーダルダイアログ表示
- テキストエリアで遷移先と処理を編集
- Ctrl+S で保存

**試験設計**:
- TC-2.3.1: セルダブルクリックでダイアログが開くこと
- TC-2.3.2: Ctrl+S で保存され、セルに反映されること
- TC-2.3.3: Esc でダイアログが閉じること

**実装内容**:
```typescript
// src/ui/components/TransitionTable/CellEditorDialog.tsx
```
- モーダルダイアログ実装
- フォーム入力・保存ロジック

**試験実行**: E2E テスト

---

#### Task 2.4: 検索・フィルタ機能
**仕様確認**:
- Fuse.js による全文検索
- 結果ダイアログ表示
- ヒットセルへのスクロール＆フォーカス移動

**試験設計**:
- TC-2.4.1: Ctrl+F で検索ダイアログが開くこと
- TC-2.4.2: 検索結果が正しく表示されること
- TC-2.4.3: 結果リスト選択で該当セルへスクロールすること
- TC-2.4.4: ↑↓キーで結果リスト内を移動できること

**実装内容**:
```typescript
// src/ui/components/TransitionTable/SearchDialog.tsx
// src/core/search/FuzzySearch.ts
```
- Fuse.js 統合
- 検索結果ダイアログ実装
- ハイライト表示

**試験実行**: E2E テスト

---

#### Task 2.5: ズーム機能
**仕様確認**:
- Ctrl+ホイール、+/-キーで25–400%
- ズーム倍率をパネル単位で保存

**試験設計**:
- TC-2.5.1: Ctrl+ホイールでズームできること
- TC-2.5.2: +/-キーでズームできること
- TC-2.5.3: Ctrl+0 でリセットできること
- TC-2.5.4: ズーム倍率が保存・復元されること

**実装内容**:
```typescript
// src/ui/components/TransitionTable/ZoomControl.tsx
// src/core/state/PanelStore.ts
```
- ズーム制御ロジック
- ズーム倍率永続化

**試験実行**: E2E テスト

---

#### Task 2.6: 行折畳機能
**仕様確認**:
- 行単位・全体一括で折畳/展開
- 階層状態対応

**試験設計**:
- TC-2.6.1: 折畳ボタンで行が折畳まれること
- TC-2.6.2: 全体一括折畳ボタンが動作すること
- TC-2.6.3: 階層状態の親子関係が正しく反映されること

**実装内容**:
```typescript
// src/ui/components/TransitionTable/RowGrouping.tsx
```
- AG Grid の Row Grouping 機能利用
- 折畳状態管理

**試験実行**: E2E テスト

---

## Phase 3: 擬似コードDSLとパーサ実装

### 目的
- 擬似コードの文法定義とパーサ実装
- Monaco Editor 統合
- AST 生成とバリデーション

### タスク一覧

#### Task 3.1: DSL文法定義とパーサ実装
**仕様確認**:
- Chevrotain ベースのパーサ
- 文法: 順次/分岐(if/elseif/else)/反復(for/while)/break/continue/emit
- [doc/25_algorithm_design_document.md](../doc/25_algorithm_design_document.md) Section 2参照

**試験設計**:
- TC-3.1.1: 順次実行の文がパースできること
- TC-3.1.2: if/elseif/else がパースできること
- TC-3.1.3: for/while がパースできること
- TC-3.1.4: break/continue がパースできること(ループ内のみ)
- TC-3.1.5: ループ外の break/continue がパースエラーになること
- TC-3.1.6: 未閉じブロックがパースエラーになること
- TC-3.1.7: 行番号付きエラーメッセージが返されること

**実装内容**:
```typescript
// src/core/dsl/Lexer.ts
// src/core/dsl/Parser.ts
// src/core/dsl/AST.ts
```
- Chevrotain レクサー・パーサー実装
- AST ノード定義
- エラーハンドリング

**試験実行**: `test/core/dsl/Parser.test.ts`

---

#### Task 3.2: DSLインタプリタ実装
**仕様確認**:
- AST を解釈して実行
- 変数・定数の管理
- break/continue 制御フロー
- [doc/25_algorithm_design_document.md](../doc/25_algorithm_design_document.md) Section 2参照

**試験設計**:
- TC-3.2.1: 変数代入が正しく動作すること
- TC-3.2.2: if/else 分岐が正しく動作すること
- TC-3.2.3: for ループが正しく動作すること
- TC-3.2.4: while ループが正しく動作すること
- TC-3.2.5: break でループを脱出できること
- TC-3.2.6: continue で次の反復に移ること
- TC-3.2.7: ネストループで break が正しく動作すること(TC-09〜12, ADR 92)
- TC-3.2.8: 未定義変数でエラーが発生すること
- TC-3.2.9: 型不一致でエラーが発生すること
- TC-3.2.10: ゼロ除算でエラーが発生すること
- TC-3.2.11: 無限ループ検出(10,000反復)が動作すること

**実装内容**:
```typescript
// src/core/dsl/Interpreter.ts
// src/core/dsl/Environment.ts
// src/core/dsl/RuntimeError.ts
```
- インタプリタ実装
- 環境(変数スコープ)管理
- 実行時エラーハンドリング

**試験実行**: `test/core/dsl/Interpreter.test.ts`

---

#### Task 3.3: Monaco Editor 統合
**仕様確認**:
- セル編集ダイアログに Monaco Editor 埋め込み
- シンタックスハイライト
- 変数・キーワード補完(Ctrl+Space)
- リアルタイムパースエラー表示

**試験設計**:
- TC-3.3.1: Monaco Editor が正しく表示されること
- TC-3.3.2: DSL キーワードがハイライトされること
- TC-3.3.3: Ctrl+Space で補完候補が表示されること
- TC-3.3.4: パースエラーが赤波線で表示されること
- TC-3.3.5: エラーマーカーホバーでメッセージが表示されること

**実装内容**:
```typescript
// src/ui/components/PseudoCodeEditor/MonacoEditor.tsx
// src/ui/components/PseudoCodeEditor/LanguageDefinition.ts
// src/ui/components/PseudoCodeEditor/CompletionProvider.ts
```
- Monaco Editor React コンポーネント
- DSL 言語定義(トークン、シンタックス)
- 補完プロバイダー実装
- エラーマーカー表示

**試験実行**: E2E テスト

---

#### Task 3.4: アクション図生成(基本版)
**仕様確認**:
- AST からフローチャート風の図を生成
- 順次/分岐/反復をノードとエッジで表現

**試験設計**:
- TC-3.4.1: 順次実行のアクション図が生成されること
- TC-3.4.2: if/else のアクション図が生成されること
- TC-3.4.3: ループのアクション図が生成されること
- TC-3.4.4: break/continue が正しく表現されること

**実装内容**:
```typescript
// src/core/dsl/ActionDiagramGenerator.ts
```
- AST → アクション図データ変換
- ノード/エッジ構造定義

**試験実行**: `test/core/dsl/ActionDiagramGenerator.test.ts`

---

## Phase 4: 状態遷移図実装

### 目的
- React Flow を使用した状態遷移図の実装
- レイアウトエンジン(elkjs/dagre)統合
- Draw.io風の編集操作

### タスク一覧

#### Task 4.1: 基本図表示
**仕様確認**:
- React Flow 使用
- ノード(状態)、エッジ(遷移)表示
- ズーム・パン操作

**試験設計**:
- TC-4.1.1: 図が正しく表示されること
- TC-4.1.2: ノードがドラッグできること
- TC-4.1.3: ズーム・パンが正しく動作すること

**実装内容**:
```typescript
// src/ui/components/StateDiagram/StateDiagram.tsx
// src/ui/components/StateDiagram/NodeTypes.ts
// src/ui/components/StateDiagram/EdgeTypes.ts
```
- React Flow 基本設定
- カスタムノード・エッジ定義

**試験実行**: E2E テスト

---

#### Task 4.2: レイアウトエンジン統合
**仕様確認**:
- elkjs(標準)、dagre(オプション)
- プルダウンメニューで切替
- レイアウト適用後の手動調整保持

**試験設計**:
- TC-4.2.1: elkjs でレイアウトが適用されること
- TC-4.2.2: dagre でレイアウトが適用されること
- TC-4.2.3: レイアウト切替時に座標変換が正しく動作すること
- TC-4.2.4: 手動調整座標が保持されること
- TC-4.2.5: 500ms以内にレイアウトが完了すること

**実装内容**:
```typescript
// src/core/layout/LayoutEngine.ts
// src/core/layout/ElkjsAdapter.ts
// src/core/layout/DagreAdapter.ts
// src/core/layout/CoordinateConverter.ts
```
- レイアウトエンジンアダプター実装
- 座標変換アルゴリズム([doc/25_algorithm_design_document.md](../doc/25_algorithm_design_document.md) Section 5)

**試験実行**: `test/core/layout/*.test.ts` + 性能測定

---

#### Task 4.3: Draw.io風編集操作
**仕様確認**:
- ノード配置、エッジ接続
- 複数選択、コピー/貼付、削除
- キーボード移動(矢印キー1px、Shift+矢印10px)
- グリッドスナップ(16px、Alt押下で無効化)

**試験設計**:
- TC-4.3.1: ツールバーからノードを配置できること
- TC-4.3.2: ノード間をドラッグでエッジ接続できること
- TC-4.3.3: Shift+クリックで複数選択できること
- TC-4.3.4: Ctrl+C/V でコピー/貼付できること
- TC-4.3.5: Delete で削除できること
- TC-4.3.6: 矢印キーで移動できること
- TC-4.3.7: グリッドスナップが動作すること

**実装内容**:
```typescript
// src/ui/components/StateDiagram/EditingControls.tsx
// src/ui/components/StateDiagram/KeyboardHandler.tsx
// src/ui/components/StateDiagram/SnapGrid.ts
```
- 編集操作ハンドラー実装
- キーボードショートカット実装
- スナップ機能実装

**試験実行**: E2E テスト

---

#### Task 4.4: 階層状態対応
**仕様確認**:
- 親子ノードのネスト表示
- 親ノードダブルクリックで折畳/展開
- 最大階層深さ5

**試験設計**:
- TC-4.4.1: 親子ノードがネスト表示されること
- TC-4.4.2: 親ノード折畳で子ノードが非表示になること
- TC-4.4.3: 階層深さ6以上で警告が表示されること

**実装内容**:
```typescript
// src/ui/components/StateDiagram/HierarchicalNode.tsx
```
- 階層ノード実装
- 折畳ロジック

**試験実行**: E2E テスト

---

#### Task 4.5: 表/図のリアルタイム双方向同期
**仕様確認**:
- 表ビューの編集が即座に図ビューに反映
- 図ビューの編集が即座に表ビューに反映

**試験設計**:
- TC-4.5.1: 表でセル編集すると図のエッジが更新されること
- TC-4.5.2: 図でノード移動すると表の状態が更新されること(該当なしの場合はスキップ)
- TC-4.5.3: 同期が100ms以内で完了すること

**実装内容**:
```typescript
// src/core/state/SyncManager.ts
```
- リアクティブ同期ロジック
- Zustand store の subscribe 活用

**試験実行**: E2E テスト + 性能測定

---

## Phase 5: シミュレーション機能実装

### 目的
- 初期状態・変数設定とイベント列実行
- ログ記録と可視化(折れ線/ステップチャート)
- 一時停止/再開/停止制御

### タスク一覧

#### Task 5.1: シミュレーションエンジン実装
**仕様確認**:
- 初期状態・変数を設定
- イベント列を順次実行
- ステップログ記録(`{stmtId, varsDelta, stateDelta, emits, type?, error?}`)

**試験設計**:
- TC-5.1.1: 初期設定が正しく動作すること
- TC-5.1.2: イベント実行で状態遷移すること
- TC-5.1.3: 擬似コード実行で変数が更新されること
- TC-5.1.4: ログが正しく記録されること
- TC-5.1.5: emit で次のイベントが発火すること

**実装内容**:
```typescript
// src/core/simulation/SimulationEngine.ts
// src/core/simulation/StepLogger.ts
```
- シミュレーションエンジン実装
- ステップログ記録

**試験実行**: `test/core/simulation/SimulationEngine.test.ts`

---

#### Task 5.2: シミュレーション制御(一時停止/再開/停止)
**仕様確認**:
- 状態遷移: Idle → Running → Paused → Running → Completed/Error/Stopped
- [doc/23_ux_design_document.md](../doc/23_ux_design_document.md) Section 5.4-5.5参照

**試験設計**:
- TC-5.2.1: 実行ボタンで Running に遷移すること
- TC-5.2.2: 一時停止ボタンで Paused に遷移すること
- TC-5.2.3: 再開ボタンで Running に遷移すること
- TC-5.2.4: 停止ボタンで Stopped に遷移すること
- TC-5.2.5: 全イベント完了で Completed に遷移すること
- TC-5.2.6: エラー発生で Error に遷移すること

**実装内容**:
```typescript
// src/core/simulation/SimulationController.ts
// src/core/state/SimulationStore.ts
```
- 状態機械実装
- 制御コマンド(start/pause/resume/stop)

**試験実行**: `test/core/simulation/SimulationController.test.ts`

---

#### Task 5.3: シミュレーション可視化データ生成
**仕様確認**:
- 折れ線チャート用 series とステップチャート用 series を生成
- [doc/25_algorithm_design_document.md](../doc/25_algorithm_design_document.md) Section 3参照
- 10,000ステップ超での間引き処理

**試験設計**:
- TC-5.3.1: 折れ線 series が正しく生成されること
- TC-5.3.2: ステップ series が正しく生成されること
- TC-5.3.3: 定数列で重複点が増えないこと
- TC-5.3.4: 10,000ステップ超で間引きが動作すること

**実装内容**:
```typescript
// src/core/simulation/SeriesGenerator.ts
```
- 可視化データ生成アルゴリズム

**試験実行**: `test/core/simulation/SeriesGenerator.test.ts`

---

#### Task 5.4: シミュレーションUI実装
**仕様確認**:
- 設定ダイアログ(初期状態・変数・イベント列)
- タイムライン表示
- レポート表示(折れ線/ステップチャート切替)

**試験設計**:
- TC-5.4.1: 設定ダイアログが正しく表示されること
- TC-5.4.2: タイムラインが正しく表示されること
- TC-5.4.3: 折れ線チャートが正しく表示されること
- TC-5.4.4: ステップチャートに切替できること
- TC-5.4.5: エラーステップが赤色マークされること

**実装内容**:
```typescript
// src/ui/components/Simulation/SimulationDialog.tsx
// src/ui/components/Simulation/Timeline.tsx
// src/ui/components/Simulation/ChartView.tsx
```
- シミュレーションUI実装
- チャートライブラリ統合(Recharts等)

**試験実行**: E2E テスト

---

## Phase 6: エクスポート・LLM連携実装

### 目的
- Excel/Markdown エクスポート
- LLM によるコード生成・リバース
- エラーハンドリング

### タスク一覧

#### Task 6.1: Excel エクスポート
**仕様確認**:
- exceljs 使用
- 状態遷移表と図を選択的に含める

**試験設計**:
- TC-6.1.1: Excel ファイルが正しく生成されること
- TC-6.1.2: 状態遷移表が正しく出力されること
- TC-6.1.3: 複数シートが作成されること

**実装内容**:
```typescript
// src/infra/export/ExcelExporter.ts
```
- exceljs による Excel 生成

**試験実行**: `test/infra/export/ExcelExporter.test.ts`

---

#### Task 6.2: Markdown エクスポート
**仕様確認**:
- markdown-it 使用
- 状態遷移表をテーブル形式で出力

**試験設計**:
- TC-6.2.1: Markdown ファイルが正しく生成されること
- TC-6.2.2: テーブル形式が正しいこと

**実装内容**:
```typescript
// src/infra/export/MarkdownExporter.ts
```
- Markdown 生成

**試験実行**: `test/infra/export/MarkdownExporter.test.ts`

---

#### Task 6.3: LLM連携実装
**仕様確認**:
- OpenAI API ラッパー
- コード生成・リバース機能
- エラーハンドリング([doc/11_software_requirement_specification.md](../doc/11_software_requirement_specification.md) Section 12.1参照)

**試験設計**:
- TC-6.3.1: LLM API 呼び出しが成功すること(モック使用)
- TC-6.3.2: ネットワークエラー時にリトライされること
- TC-6.3.3: タイムアウト時にエラーが表示されること
- TC-6.3.4: 不正な応答時にフォールバックすること

**実装内容**:
```typescript
// src/infra/llm/OpenAIClient.ts
// src/infra/llm/ErrorHandler.ts
```
- OpenAI API クライアント実装
- エラーハンドリング実装

**試験実行**: `test/infra/llm/*.test.ts`(モック使用)

---

#### Task 6.4: エクスポート・LLM UI実装
**仕様確認**:
- エクスポート設定モーダル
- LLM 実行確認ダイアログ
- マスキングオプション

**試験設計**:
- TC-6.4.1: エクスポート設定ダイアログが表示されること
- TC-6.4.2: LLM 確認ダイアログが表示されること
- TC-6.4.3: マスキング設定が動作すること

**実装内容**:
```typescript
// src/ui/components/Export/ExportDialog.tsx
// src/ui/components/LLM/LLMConfirmDialog.tsx
```
- エクスポート・LLM UI実装

**試験実行**: E2E テスト

---

## Phase 7: パネル・エクスプローラ・テーマ実装

### 目的
- 複数パネル管理(最小化/最大化/リサイズ)
- サイドバーエクスプローラ
- テーマ切替(ライト/ダーク/Serendie)

### タスク一覧

#### Task 7.1: パネル管理実装
**仕様確認**:
- パネルのドラッグ＆リサイズ
- スナップドッキング(16pxグリッド)
- 最小化/最大化
- [doc/25_algorithm_design_document.md](../doc/25_algorithm_design_document.md) Section 4参照

**試験設計**:
- TC-7.1.1: パネルがドラッグできること
- TC-7.1.2: リサイズできること
- TC-7.1.3: スナップが動作すること
- TC-7.1.4: 最小化/最大化が動作すること
- TC-7.1.5: レイアウトが保存・復元されること

**実装内容**:
```typescript
// src/ui/components/Panel/PanelManager.tsx
// src/ui/components/Panel/DraggablePanel.tsx
// src/core/layout/SnapGrid.ts
```
- パネルコンポーネント実装
- スナップアルゴリズム実装

**試験実行**: E2E テスト

---

#### Task 7.2: エクスプローラ実装
**仕様確認**:
- サイドバー型エクスプローラ
- 状態遷移の参照/折畳/展開/複製/削除
- 左右配置切替

**試験設計**:
- TC-7.2.1: エクスプローラが表示されること
- TC-7.2.2: ツリー表示が動作すること
- TC-7.2.3: 複製/削除が動作すること
- TC-7.2.4: 左右配置切替が動作すること

**実装内容**:
```typescript
// src/ui/components/Explorer/Explorer.tsx
// src/ui/components/Explorer/TreeView.tsx
```
- エクスプローラ実装

**試験実行**: E2E テスト

---

#### Task 7.3: テーマ実装
**仕様確認**:
- ライト/ダーク/Serendie の3系列
- MUI テーマカスタマイズ
- 即時反映

**試験設計**:
- TC-7.3.1: ライトテーマが適用されること
- TC-7.3.2: ダークテーマが適用されること
- TC-7.3.3: Serendie テーマが適用されること
- TC-7.3.4: テーマ切替が即座に反映されること

**実装内容**:
```typescript
// src/ui/theme/ThemeProvider.tsx
// src/ui/theme/LightTheme.ts
// src/ui/theme/DarkTheme.ts
// src/ui/theme/SerendieTheme.ts
```
- MUI テーマ定義
- テーマプロバイダー実装

**試験実行**: E2E テスト

---

#### Task 7.4: 自動保存・スナップショット実装
**仕様確認**:
- 自動保存(デフォルト30秒)
- スナップショット取得(最新3世代)
- クラッシュ検出と復旧
- [doc/11_software_requirement_specification.md](../doc/11_software_requirement_specification.md) Section 14.2参照

**試験設計**:
- TC-7.4.1: 自動保存が動作すること
- TC-7.4.2: スナップショットが取得されること
- TC-7.4.3: 世代管理が動作すること
- TC-7.4.4: クラッシュ検出が動作すること
- TC-7.4.5: 復旧ダイアログが表示されること

**実装内容**:
```typescript
// src/infra/autosave/AutoSaveManager.ts
// src/infra/snapshot/SnapshotManager.ts
// src/infra/recovery/CrashDetector.ts
```
- 自動保存・スナップショット実装
- クラッシュ検出・復旧実装

**試験実行**: `test/infra/autosave/*.test.ts`

---

## Phase 8: 統合テストと性能最適化

### 目的
- E2E テストの完全実施
- 性能要件の検証と最適化
- バグ修正

### タスク一覧

#### Task 8.1: E2E テスト実装
**仕様確認**:
- 主要操作フロー(表編集、図編集、検索、シミュレーション、エクスポート)
- [doc/11_software_requirement_specification.md](../doc/11_software_requirement_specification.md) Section 15参照

**試験設計**:
- TC-8.1.1: FR-001〜FR-023 がすべて動作すること
- TC-8.1.2: 代表的なプロジェクトを Excel/Markdown に出力できること
- TC-8.1.3: if/for/while を含むサンプルがシミュレーションで実行されること
- TC-8.1.4: dagre/elkjs でレイアウトが適用され、手動編集が保持されること

**実装内容**:
```typescript
// test/e2e/*.spec.ts
```
- Playwright による E2E テスト実装

**試験実行**: E2E テスト一括実行

---

#### Task 8.2: 性能測定と最適化
**仕様確認**:
- [doc/11_software_requirement_specification.md](../doc/11_software_requirement_specification.md) Section 13.1参照
- 測定対象: セルスクロール、検索、ズーム、行折畳、図レイアウト、Undo/Redo

**試験設計**:
- TC-8.2.1: セルスクロール 100ms 以内
- TC-8.2.2: 検索実行 200ms 以内
- TC-8.2.3: ズーム操作 50ms 以内
- TC-8.2.4: 行折畳 100ms 以内
- TC-8.2.5: 図レイアウト 500ms 以内
- TC-8.2.6: Undo/Redo 100ms 以内

**実装内容**:
- 性能測定スクリプト作成
- ボトルネック特定と最適化

**試験実行**: 性能測定 + 最適化イテレーション

---

#### Task 8.3: バグ修正とリファクタリング
**仕様確認**:
- テスト失敗箇所の修正
- コード品質向上

**試験設計**:
- 全テストがパスすること

**実装内容**:
- バグ修正
- リファクタリング

**試験実行**: 全テスト再実行

---

## 開発スケジュール概算

| Phase | 概算工数 | 累積工数 |
|-------|---------|---------|
| Phase 1 | 5日 | 5日 |
| Phase 2 | 7日 | 12日 |
| Phase 3 | 5日 | 17日 |
| Phase 4 | 7日 | 24日 |
| Phase 5 | 5日 | 29日 |
| Phase 6 | 4日 | 33日 |
| Phase 7 | 6日 | 39日 |
| Phase 8 | 6日 | 45日 |

**合計**: 約45営業日(約9週間)

---

## リスクと対策

### 技術的リスク
1. **DSL パーサの複雑性**: Chevrotain の学習コストが高い → 早期PoC実施
2. **AG Grid の性能**: 10,000セルでの性能が不十分 → 仮想スクロールと遅延レンダリングで対策
3. **レイアウトエンジンの不安定性**: elkjs/dagre のバグ → 複数エンジン対応でリスクヘッジ
4. **IndexedDB の制約**: ストレージ容量制限 → 圧縮(LZ4)で対策

### スケジュールリスク
1. **要件追加**: Phase完了時に要件レビューを実施し、早期に変更を検出
2. **バグ多発**: Phase 8 にバッファを確保

---

## 次のアクション
1. Task 1.1 から順次実装を開始
2. 各タスク完了時にこのドキュメントを更新
3. Phase完了時に設計書(doc/2*.md)を更新
