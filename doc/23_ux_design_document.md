# UX設計ドキュメント

## 1. 目的
- 状態遷移設計支援ツールの主要画面・操作・ナビゲーションを定義し、実装とテストの参照基準とする。
- 前提: SRS(doc/11_software_requirement_specification.md) と機能設計(doc/22_function_design_document.md) の 2025-12-09 版。

## 2. ペルソナと利用コンテキスト
- **システムエンジニア**: 既存装置の状態遷移を再設計。短時間で表と図を往復し整合性確認。オフライン作業多め。
- **UX/QA 担当**: 振る舞い仕様をレビューし、シミュレーションログを確認。検索/ハイライトとレポート出力を重視。
- **開発者**: コード生成・リバースを併用。LLM 連携はオンライン時のみ使用。

## 3. 情報アーキテクチャ
- **左/右サイドバー**: 状態遷移エクスプローラ（プロジェクト内の遷移セット一覧）。折畳/展開/複製/削除、左右配置と非表示トグル。
- **メインキャンバス**: 複数パネルをタブレスで並置。各パネルは「表ビュー」「図ビュー」を切替。パネルごとにズーム・表示モードを保持。
- **ユーティリティバー**: 検索、ズーム、レイアウト選択、テーマ切替、シミュレーション開始/停止をまとめた上部バー。
- **ドロワー/モーダル**: 擬似コード編集ダイアログ、検索結果ダイアログ、シミュレーション設定ダイアログ、エクスポート設定ダイアログ。

## 4. 主要画面・レイアウト
- **ホーム（プロジェクト選択）**: 最近プロジェクトカード、テンプレート新規、インポート。テーマ選択はここにも配置。
- **編集画面（標準）**: 左右にサイドバー可変、中央にパネルグリッド。上部にユーティリティバー。フッターに状態表示（ズーム率、選択セル、選択ノード、Undo/Redo ステータス）。
- **シミュレーション画面**: 編集画面上でオーバーレイ。左にシナリオ設定（初期状態・変数・イベント列）、右にログ/タイムライン/レポートタブ。実行/一時停止/再開ボタンを上部に固定。
- **エクスポート/LLM 画面**: モーダル。表/図の選択、書式テンプレート選択、コード生成対象言語、リバース入力テキストエリアを含む。

## 5. 主要操作フロー（概略）
- **表を編集**: イベント・状態リスト選択 → セルダブルクリックで処理編集 → Monaco 上で擬似コード入力 → 保存でセル反映 → 表示モードを切替（処理/遷移先/両方）。
- **図を編集**: 図ビューでノードを配置・接続 → レイアウト選択(dagre/elkjs)を適用 → 位置微調整 → 表ビューと同期確認。
- **検索/フィルタ**: 検索バー入力 → 結果ダイアログにヒット一覧 → 選択で該当セル/ノードへスクロール＆フォーカス → フィルタ履歴から再適用可。
- **シミュレーション**: 設定ダイアログで初期値/イベント列入力 → 実行 → タイムラインでステップ進行確認 → 一時停止/再開 → 完了後にレポートを閲覧・CSV/JSON で出力。
- **シミュレーション可視化**: レポートで折れ線/ステップチャートを切替可能（ADR doc/91_adr_poc_ui_behavior.md）。
- **エクスポート/LLM**: モーダルで形式・テンプレート・対象ビューを選択 → 実行 → 保存先を確認。オンライン時のみ LLM 生成/リバースを有効化。

## 6. キー UI コンポーネント仕様
- **AG Grid 設定**: 固定ヘッダ、仮想スクロール、階層折畳、セルエディタはダブルクリックで擬似コードダイアログ。ショートカット: Enter 編集、Ctrl+C/V コピー/貼付、Ctrl+Z/Y Undo/Redo。
- **React Flow 図キャンバス**: ズーム・パン（ホイール+ドラッグ）、ノード/エッジ選択、複数選択、Delete で削除、方向キーで 1px/Shift+方向で 10px 移動。スナップライン表示。
- **ズームコントロール**: ユーティリティバーの + / - / リセット、Ctrl+ホイール、ショートカット `Ctrl+Plus`, `Ctrl+Minus`, `Ctrl+0`。
- **テーマトグル**: ライト/ダーク/Serendie。即時反映し、パネル・サイドバーに適用。
- **検索ダイアログ**: ハイライト色をテーマに連動。結果リストで上下キー/マウス選択により表または図上の対象へフォーカス移動。
- **パネル管理**: 見出しバーに最小化/最大化/閉じる。ドラッグでリサイズ、格子状スナップ。ビュー種別（表/図）とズーム率を記憶。
- **ショートカットヘルプ**: 全体のキーボード操作一覧は `doc/27_keyboard_shortcuts.md` を参照。
- **パネルドッキング**: 簡易スナップグリッドによるドッキングを提供し、配置をローカル保存（ADR doc/91_adr_poc_ui_behavior.md）。

## 7. アクセシビリティと操作性
- フォーカスリングを全入力・セル・ノードに表示。Tab/Shift+Tab で主要フォーカス順を定義。
- キーボードのみで表編集（Enter で編集、F2 で再編集、Ctrl+F で検索）、図操作（矢印移動、Delete 削除、Ctrl+D 複製）を完結可能にする。
- カラーテーマはコントラスト比を WCAG AA 目標で調整（特にハイライトとエラーメッセージ）。
- Serendie テーマではアクセント/ハイライト色を明度補正し、コントラストを確保（ADR doc/91_adr_poc_ui_behavior.md）。

## 8. エラー表示とフィードバック
- 擬似コードパースエラー: 行番号付きトースト＋エディタ内マーカー。
- 保存/エクスポート/LLM 実行: 成功時スナックバー、失敗時は原因とリトライ提示。
- シミュレーション中断: エラー発生ステップをタイムラインにマークし詳細をサイドパネルに表示。

## 9. ローカライズ
- UI ラベルは日本語をデフォルト。英語化は将来拡張としてキー分離（i18n JSON）を前提に設計。

## 10. 未決事項 / TODO
- シミュレーションログの可視化チャート種類（折れ線/ステップチャート）の最終選定。
- 複数パネルをドラッグでドッキングする UI 挙動（スナップ領域の有無）を PoC で確定。
- Serendie テーマのアクセント色とハイライト色のコントラスト微調整。
